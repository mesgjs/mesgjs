<!doctype html><html><head>
<style>
textarea { width: 95%; resize: vertical; min-height: 100px; }
</style>
<script type='importmap'>
{
    "imports": {
	"syscl/": "./"
    }
}
</script>
</head><body>
<h2>SysCL</h2>
<textarea id='inputArea' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea><br>
<input type='button' value='Transpile' id='execBtn'>
<h2>Errors</h2>
<textarea id='errors' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
<h2>JavaScript</h2>
<textarea id='codeArea' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
<h2>Source Map</h2>
<p><input type='checkbox' id='inlineMap'> Inline source map</p>
<textarea id='mapArea' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
<script type='module'>
import { transpile, mappingGenerator } from 'syscl/transpile.esm.js';
function transpileNow () {
    const tr = transpile(inputArea.value, { addWhiteSpace: true, enableJS: true, location: { src: 'unnamed.scl' } });
    const errs = [];
    codeArea.value = tr.code;
    if (tr.fatal) errs.push("FATAL: " + tr.fatal);
    errs.push(...tr.errors);
    errors.value = errs.join("\n");
    if (tr.segments) {
	globalThis.sysclSegments = tr.segments;
	const mapping = mappingGenerator(tr.segments);
	if (inlineMap.checked) mapping.sourcesContent = [ inputArea.value ];
	const mapJSON = JSON.stringify(mapping);
	mapArea.value = mapJSON;
	if (inlineMap.checked) codeArea.value += "//# sourceMappingURL=data:application/json;base64," + btoa(mapJSON);
    } else {
	globalThis.sysclSegments = [];
	mapArea.value = '';
    }
}
execBtn.addEventListener('click', transpileNow);
</script>
<!--
vim: sw=4:syntax=javascript
-->
</body></html>
