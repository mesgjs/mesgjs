import{getInterface as R,runIfCode as w,setRO as v,throwFlow as d}from"./runtime.esm.js";import{NANOS as j}from"./vendor.esm.js";function b(c){const{mp:t,js:e}=c,u=parseInt(t.at("times",1),10),p=Number.isInteger(u)?u:1,f=t.at("collect");let s=f?new j:void 0;const o=i=>{f?s.push(i):s=i},h=i=>{if(!e.capture)throw i;return e.hasFlowRes&&(o(e.flowRes),e.hasFlowRes=e.flowRes=!1),i.message==="stop"};e.times=p,e.active=!0;try{if(c.dop==="arun")return(async()=>{for(let i=0;i<p;++i){e.capture=!1,e.iteration=i;try{o(await w(t.at(0)))}catch(l){if(h(l))break}}return s})();for(let i=0;i<p;++i){e.capture=!1,e.iteration=i;try{o(w(t.at(0)))}catch(l){if(h(l))break}}return s}finally{e.active=!1}}function k(c){const{mp:t,js:e}=c,u=a=>a?.msjsType==="@code"?a:void 0,p=t.at(0),f=u(t.at(1)),s=u(t.at("pre")),o=f&&u(t.at("mid")),h=u(t.at("post"));if(!s&&!o&&!h)throw new SyntaxError("(while) test {block!} required");const i=t.at("collect");let l=i?new j:void 0;const m=a=>{i?l.push(a):l=a},n=a=>{if(!e.capture||(e.hasFlowRes&&(m(e.flowRes),e.hasFlowRes=e.flowRes=!1),a.message==="stop"))throw a;e.capture=!1},y=a=>{if(e.active=!1,!e.capture)throw a;return a.message==="stop"?!0:(e.active=!0,!1)};e.times=void 0,e.active=!0;try{if(c.dop==="awhile")return(async()=>{for(let a=0;;++a){e.capture=!1,e.iteration=a;try{try{if(s&&!await s("run"))break}catch(r){n(r)}try{m(await w(p))}catch(r){n(r)}if(f){try{if(o&&!await o("run"))break}catch(r){n(r)}try{await f("run")}catch(r){n(r)}}try{if(h&&!awaitpost("run"))break}catch(r){n(r)}}catch(r){if(y(r))break}}return l})();for(let a=0;;++a){e.capture=!1,e.iteration=a;try{try{if(s&&!s("run"))break}catch(r){n(r)}try{m(w(p))}catch(r){n(r)}if(f){try{if(o&&!o("run"))break}catch(r){n(r)}try{f("run")}catch(r){n(r)}}try{if(h&&!h("run"))break}catch(r){n(r)}}catch(r){if(y(r))break}}return l}finally{e.active=!1}}function F(c){R(c).set({lock:!0,pristine:!0,handlers:{"@init":t=>v(t.octx,"js",{}),active:t=>!!t.js.active,arun:b,awhile:k,num:t=>t.js.iteration,num1:t=>t.js.iteration+1,next:t=>d(t,"next",c),rem:t=>t.js.times?t.js.times-t.js.iteration-1:void 0,rem1:t=>t.js.times?t.js.times-t.js.iteration:void 0,run:b,stop:t=>d(t,"stop",c),times:t=>t.js.times,while:k},cacheHints:{while:"pin"}})}export{F as install};
