{
  "version": 3,
  "sources": ["../../src/runtime/msjs-list.esm.js"],
  "sourcesContent": ["/*\n * Mesgjs NANOS wrapper interface\n * Author: Brian Katzung <briank@kappacs.com>\n * Copyright 2025 by Kappa Computer Solutions, LLC and Brian Katzung\n */\n\nimport { getInstance, getInterface, runIfCode, msjsInstance, setRO } from './runtime.esm.js';\nimport { unifiedList } from './unified-list.esm.js';\nimport { NANOS } from './vendor.esm.js';\n\nfunction opInit (d) {\n    const { octx, mp } = d, list = mp.at(0);\n    setRO(octx, 'js', (list instanceof NANOS) ? list : new NANOS());\n    setRO(d.js, msjsInstance, d.rr, false);\n}\n\nfunction opAt (d) {\n    const { mp } = d, path = mp.has('path') ? unifiedList(mp.at('path')).values() : mp.values();\n    let cur = d.js;\n    for (const k of path) {\n\tif (cur.has(k)) cur = unifiedList(cur.at(k));\n\telse if (mp.has('else')) return runIfCode(mp.at('else'));\n\telse throw new Error('Key path not found');\n    }\n    return cur;\n}\n\nfunction doGet () {\n    if (this.list.has(this.key)) return this.list.at(this.key);\n    if (this.hasElse) return runIfCode(this.elseVal);\n    throw new Error(`Required key ${this.key} not present`);\n}\n\nfunction opGetter (d) {\n    const { js: list, mp } = d;\n    const key = mp.at(0), hasElse = mp.has('else'), elseVal = mp.at('else');\n    return d.b({ cd: doGet.bind({ list, key, hasElse, elseVal }) });\n}\n\nfunction opNext (d) {\n    if (d.mp.has(0)) {\n\td.js.next = d.mp.at(0);\n\treturn d.rr;\n    }\n    return d.js.next;\n}\n\nfunction opNset (d) {\n    const { mp, js } = d;\n    for (const e of mp.entries()) js.set(e[0], e[1]);\n}\n\nfunction opRIO (d) {\n    const { js, mp } = d;\n    if (mp.has(0)) {\n\tlet rio = mp.at(0);\n\tif (rio === true) rio = getInstance('@reactive')('rio');\n\tjs.rio = rio;\t\t// NANOS will validate\n\treturn d.rr;\n    }\n    return !!js.rio;\n}\n\nfunction doSet (d) {\n    this.list.set(this.key, d.mp.at(0));\n}\n\nfunction opSetter (d) {\n    const { js: list, mp } = d, key = mp.at(0);\n    return d.b({ cd: doSet.bind({ list, key }) })('fn');\n}\n\n// Supported key types\nconst skt = k => { const t = typeof k; return t === 'string' || t === 'number' || t === 'symbol'; };\n\nfunction opSet (d) {\n    const { mp } = d, psrc = mp.has('path') ? unifiedList(mp.at('path')).values() : mp.values();\n    const path = [...psrc].filter(k => skt(k)), limit = path.length - (mp.has('to') ? 1 : 0);\n    let cur = d.js;\n    for (let i = 0; i < limit; ++i) {\n\tconst k = path[i];\n\tif (!(cur.at(k) instanceof NANOS)) cur.set(k, cur.similar());\n\tcur = cur.at(k);\n    }\n    if (mp.has('to')) cur.set(path[limit], mp.at('to'), mp.at('insert'));\n    else {\n\tif (mp.has('first')) cur.unshift(mp.at('first'));\n\tif (mp.has('next')) cur.push(mp.at('next'));\n    }\n}\n\nexport function install (name) {\n    getInterface(name).set({\n\tlock: true, pristine: true,\n\thandlers: {\n\t    '@init': opInit,\n\t    '@jsv': d => d.js,\n\t    at: opAt,\n\t    // autoPromote\n\t    clear: d => d.js.clear(),\n\t    copy: d => new NANOS().fromPairs(d.js.pairs()),\n\t    delete: d => d.js.delete(d.mp.at(0)),\n\t    depend: d => d.js.depend(),\n\t    entries: d => new NANOS([...d.js.entries()]),\n\t    // filter: use @kvIter\n\t    // find: use @kvIter\n\t    // findLast: use @kvIter\n\t    // forEach: use @kvIter\n\t    get: opAt,\n\t    getter: opGetter,\n\t    has: d => d.js.has(d.mp.at(0)),\n\t    includes: d => d.js.includes(d.mp.at(0)),\n\t    indexEntries: d => new NANOS([...d.js.indexEntries(d.mp.at(0))]),\n\t    indexKeys: d => new NANOS([...d.js.indexKeys()]),\n\t    isLocked: d => d.js.isLocked(d.mp.at(0)),\n\t    isRedacted: d => d.js.isRedacted(d.mp.at(0)),\n\t    keyOf: d => d.js.keyOf(d.mp.at(0)),\n\t    keyIter: d => d.js.keys(),\n\t    keys: d => new NANOS([...d.js.keys()]),\n\t    lastKeyOf: d => d.js.lastKeyOf(d.mp.at(0)),\n\t    lock: d => d.js.lock(...d.mp.indexValues()),\n\t    lockAll: d => d.js.lockAll(d.mp.at(0)),\n\t    lockKeys: d => d.js.lockKeys(),\n\t    namedEntries: d => new NANOS([...d.js.namedEntries()]),\n\t    namedKeys: d => new NANOS([...d.js.namedKeys()]),\n\t    next: opNext,\n\t    nset: opNset,\n\t    pairs: d => new NANOS(d.js.pairs(d.mp.at(0))),\n\t    pop: d => d.js.pop(),\n\t    push: d => d.js.push(d.mp),\n\t    push1: d => d.js.push(d.mp.at(0)),\n\t    redact: d => d.js.redact(...d.mp.indexValues()),\n\t    reverse: d => d.js.reverse(),\n\t    rio: opRIO,\n\t    self: d => d.js,\n\t    set: opSet,\n\t    setter: opSetter,\n\t    shift: d => d.js.shift(),\n\t    size: d => d.js.size,\n\t    toJSON: d => d.js.toJSON(),\n\t    toReversed: d => d.js.toReversed(),\n\t    toSLID: d => d.js.toSLID(d.mp?.storage || {}),\n\t    toString: d => d.js.toString(d.mp?.storage || {}),\n\t    unshift: d => d.js.unshift(d.mp),\n\t    values: d => new NANOS([...d.js.values()]),\n\t},\n\tcacheHints: {\n\t    '@init': 'pin',\n\t    at: 'pin',\n\t    has: 'pin',\n\t    nset: 'pin',\n\t    set: 'pin',\n\t},\n    });\n}\n\n// END\n"],
  "mappings": "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",
  "names": ["getInstance", "getInterface", "runIfCode", "msjsInstance", "setRO", "unifiedList", "NANOS", "opInit", "d", "octx", "mp", "list", "opAt", "path", "cur", "k", "doGet", "opGetter", "key", "hasElse", "elseVal", "opNext", "opNset", "js", "e", "opRIO", "rio", "doSet", "opSetter", "skt", "opSet", "limit", "i", "install", "name"]
}
