{
  "version": 3,
  "sources": ["../../src/runtime/msjs-list.esm.js"],
  "sourcesContent": ["/*\n * Mesgjs NANOS wrapper interface\n * Author: Brian Katzung <briank@kappacs.com>\n * Copyright 2025 by Kappa Computer Solutions, LLC and Brian Katzung\n */\n\nimport { getInstance, getInterface, runIfCode, setRO } from './runtime.esm.js';\nimport { unifiedList, uniAt } from './unified-list.esm.js';\n\nfunction opInit (d) {\n\tconst { octx, mp } = d, list = mp.at(0);\n\tsetRO(octx, 'js', (list instanceof NANOS) ? list : new NANOS());\n\tsetRO(d.rr, { jsv: d.js, valueOf: () => d.js });\n}\n\n// (at key...? path=[key...]? else=default? raw=@f)\nfunction opAt (d) {\n\tconst { mp } = d, path = mp.has('path') ? unifiedList(mp.at('path')).values() : mp.values();\n\treturn uniAt(d.js, [...path], { wrap: true, raw: mp.at('raw'),\n\t  defaultFn: () => {\n\t\tif (mp.has('else')) return runIfCode(mp.at('else'));\n\t\telse throw new Error('Key path not found');\n\t}});\n}\n\n// @code implementation for (getter)\nfunction doGet () {\n\tif (this.list.has(this.key)) return this.list.at(this.key);\n\tif (this.hasElse) return runIfCode(this.elseVal);\n\tthrow new Error(`Required key ${this.key} not present`);\n}\n\n// (getter key else=default?)\n// Returns getter @code block\nfunction opGetter (d) {\n\tconst { js: list, mp } = d;\n\tconst key = mp.at(0), hasElse = mp.has('else'), elseVal = mp.at('else');\n\treturn d.b({ cd: doGet.bind({ list, key, hasElse, elseVal }) });\n}\n\n// Return the next index key\nfunction opNext (d) {\n\tif (d.mp.has(0)) {\n\t\td.js.next = d.mp.at(0);\n\t\treturn d.rr;\n\t}\n\treturn d.js.next;\n}\n\n// (nset key=value ...)\nfunction opNset (d) {\n\tconst { mp, js } = d;\n\tfor (const e of mp.namedEntries()) js.set(e[0], e[1]);\n}\n\n// (rio), (rio object), (rio @t), (rio @u)\n// Get/set/remove reactive interface object\nfunction opRIO (d) {\n\tconst { js, mp } = d;\n\tif (mp.has(0)) {\n\t\tlet rio = mp.at(0);\n\t\tif (rio === true) rio = getInstance('@reactive')('rio');\n\t\tjs.rio = rio;\t\t\t// NANOS will validate\n\t\treturn d.rr;\n\t}\n\treturn !!js.rio;\n}\n\n// \"Reactive transform\" - make fully reactive, recursively\nfunction opRxt (d) {\n\tconst { js } = d;\n\tif (!js.rio) js.rio = getInstance('@reactive')('rio');\n\tconst rio = js.rio;\n\tjs.setOpts({ autoReactive: true });\n\tfor (const key of js.keys()) {\n\t\tconst value = js.at(key, { raw: true });\n\t\tconst isR = rio.isReactive(value), nrv = isR ? value.rv : value;\n\t\t// Convert non-reactive values to reactive ones\n\t\tif (!isR) js.set(key, value);\n\t\t// Recursively apply reactive transform to nested NANOS\n\t\tif (nrv instanceof NANOS) $toMsjs(nrv)('rxt');\n\t}\n}\n\n// @function implementation for (setter)\nfunction doSet (d) {\n\tconst mp = d.mp, insert = mp.at('insert'), raw = mp.at('raw');\n\tthis.list.set(this.key, d.mp.at(0), { insert, raw });\n}\n\n// (setter key)\n// Returns setter @function block: (call value insert=@f raw=@f?)\nfunction opSetter (d) {\n\tconst { js: list, mp } = d, key = mp.at(0);\n\treturn d.b({ cd: doSet.bind({ list, key }) })('fn');\n}\n\n// Supported key types\nconst skt = k => { const t = typeof k; return t === 'string' || t === 'number' || t === 'symbol'; };\n\n// (set key...? path=[key...]? first=value? next=value? to=value? insert=@f raw=@f)\n// list[key][...] = toValue (with optional insert, raw)\n// list[key][...].unshift(firstValue)\n// list[key][...].push(nextValue)\nfunction opSet (d) {\n\tconst { mp } = d, psrc = mp.has('path') ? unifiedList(mp.at('path')).values() : mp.values();\n\tconst insert = mp.at('insert'), raw = mp.at('raw');\n\tconst path = [...psrc].filter(k => skt(k)), limit = path.length - (mp.has('to') ? 1 : 0);\n\tlet cur = d.js;\n\tfor (let i = 0; i < limit; ++i) {\n\t\tconst k = path[i];\n\t\tif (!(cur.at(k) instanceof NANOS)) cur.set(k, cur.similar());\n\t\tcur = cur.at(k);\n\t}\n\tif (mp.has('to')) cur.set(path[limit], mp.at('to'), { insert, raw });\n\telse {\n\t\tif (mp.has('first')) cur.unshift(mp.at('first'));\n\t\tif (mp.has('next')) cur.push(mp.at('next'));\n\t}\n}\n\n// (setOpts name=value ...)\nfunction opSetOpts (d) {\n\td.js.setOpts(Object.fromEntries(d.mp.namedEntries()));\n\treturn d.rr;\n}\n\nexport function install (name) {\n\tgetInterface(name).set({\n\t\tlock: true, pristine: true,\n\t\thandlers: {\n\t\t\t'@init': opInit,\n\t\t\t'@jsv': (d) => d.js,\n\t\t\t'@': opAt,\n\t\t\t'==': opNset,\n\t\t\t'>': (d) => d.js.pop(),\n\t\t\t'|+': (d) => d.js.push(d.mp),\n\t\t\t'=': opSet,\n\t\t\t'<': (d) => d.js.shift(),\n\t\t\t'+|': (d) => d.js.unshift(d.mp),\n\t\t\tat: opAt,\n\t\t\t// autoPromote\n\t\t\tclear: (d) => d.js.clear(),\n\t\t\tcopy: (d) => new NANOS().fromPairs(d.js.pairs()),\n\t\t\tdelete: (d) => d.js.delete(d.mp.at(0)),\n\t\t\tdepend: (d) => d.js.depend(),\n\t\t\tentries: (d) => new NANOS([...d.js.entries()]),\n\t\t\t// filter: use @kvIter\n\t\t\t// find: use @kvIter\n\t\t\t// findLast: use @kvIter\n\t\t\t// forEach: use @kvIter\n\t\t\tget: opAt,\n\t\t\tgetter: opGetter,\n\t\t\thas: (d) => d.js.has(d.mp.at(0)),\n\t\t\tincludes: (d) => d.js.includes(d.mp.at(0)),\n\t\t\tindexEntries: (d) => new NANOS([...d.js.indexEntries(d.mp.at(0))]),\n\t\t\tindexKeys: (d) => new NANOS([...d.js.indexKeys()]),\n\t\t\tisLocked: (d) => d.js.isLocked(d.mp.at(0)),\n\t\t\tisRedacted: (d) => d.js.isRedacted(d.mp.at(0)),\n\t\t\tkeyOf: (d) => d.js.keyOf(d.mp.at(0)),\n\t\t\tkeyIter: (d) => d.js.keys(),\n\t\t\tkeys: (d) => new NANOS([...d.js.keys()]),\n\t\t\tlastKeyOf: (d) => d.js.lastKeyOf(d.mp.at(0)),\n\t\t\tlock: (d) => d.js.lock(...d.mp.indexValues()),\n\t\t\tlockAll: (d) => d.js.lockAll(d.mp.at(0)),\n\t\t\tlockKeys: (d) => d.js.lockKeys(),\n\t\t\tnamedEntries: (d) => new NANOS([...d.js.namedEntries()]),\n\t\t\tnamedKeys: (d) => new NANOS([...d.js.namedKeys()]),\n\t\t\tnext: opNext,\n\t\t\tnset: opNset,\n\t\t\toptions: (d) => new NANOS(d.js.options),\n\t\t\tpairs: (d) => new NANOS(d.js.pairs(d.mp.at(0))),\n\t\t\tpop: (d) => d.js.pop(),\n\t\t\tpush: (d) => d.js.push(d.mp),\n\t\t\tpush1: (d) => d.js.push(d.mp.at(0)),\n\t\t\tredact: (d) => d.js.redact(...d.mp.indexValues()),\n\t\t\treverse: (d) => d.js.reverse(),\n\t\t\trio: opRIO,\n\t\t\trxt: opRxt,\n\t\t\tself: (d) => d.js,\n\t\t\tset: opSet,\n\t\t\tsetOpts: opSetOpts,\n\t\t\tsetter: opSetter,\n\t\t\tshift: (d) => d.js.shift(),\n\t\t\tsize: (d) => d.js.size,\n\t\t\ttoJSON: (d) => d.js.toJSON(),\n\t\t\ttoReversed: (d) => d.js.toReversed(),\n\t\t\ttoSLID: (d) => d.js.toSLID(d.mp?.storage || {}),\n\t\t\ttoString: (d) => d.js.toString(d.mp?.storage || {}),\n\t\t\tunshift: (d) => d.js.unshift(d.mp),\n\t\t\tvalues: (d) => new NANOS([...d.js.values()]),\n\t\t},\n\t\tcacheHints: {\n\t\t\t'@init': 'pin',\n\t\t\tat: 'pin',\n\t\t\thas: 'pin',\n\t\t\tnset: 'pin',\n\t\t\tset: 'pin',\n\t\t},\n\t});\n}\n\n// END\n"],
  "mappings": "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",
  "names": ["getInstance", "getInterface", "runIfCode", "setRO", "unifiedList", "uniAt", "opInit", "d", "octx", "mp", "list", "opAt", "path", "doGet", "opGetter", "key", "hasElse", "elseVal", "opNext", "opNset", "js", "e", "opRIO", "rio", "opRxt", "value", "isR", "nrv", "doSet", "insert", "raw", "opSetter", "skt", "k", "opSet", "psrc", "limit", "cur", "i", "opSetOpts", "install", "name"]
}
