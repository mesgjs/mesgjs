import{getInterface as v,runIfCode as u,setRO as a}from"./runtime.esm.js";import{reactive as n}from"./vendor.esm.js";let p;function j(e){switch(e?.msjsType){case"@code":return()=>e("run");case"@function":return e("jsfn");case p:return e("@jsv").getter;default:return e}}function m(e){switch(e?.msjsType){case"@code":return e("fn")("jsfn");case"@function":return e("jsfn");default:return e}}function h(e){const{mp:t}=e,s=t.at(0);if(s?.$reactive===n.type)a(e.octx,"js",s);else{const r=t.at("cmp"),c=t.at("def");typeof r=="function"&&t.set("cmp",m(r)),typeof c=="function"&&t.set("def",j(c)),!t.has("v")&&t.has(0)&&t.set("v",t.at(0)),a(e.octx,"js",n(t?.storage||{}))}a(e.js,$c.symbols.instance,e.rr,!1),a(e.rr,{jsv:e.js,valueOf:()=>e.js})}function d(e){return n.batch(()=>u(e.mp.at(0)))}function g(e){const{js:t,mp:s}=e;for(const r of s.entries())switch(r[0]){case"def":typeof r[1]=="function"&&(t.def=j(r[1]));break;case"eager":case"eager1":case"eager2":t.eager=r[1];break;case"v":case"0":t.wv=r[1];break}return e.rr}function y(e){return n.untracked(()=>u(e.mp.at(0)))}const i=e=>!!n.typeOf(e),w=(e,t,s)=>{const r=e.atRaw(t),c=i(r),f=i(s);if(c)return f?r.def=s:r.wv=s,r;if(e.options.autoReactive){const o=n();return f?o.def=s:o.wv=s,o}return s};function l(e){return e||(e=n()),{batch:n.batch,changed:()=>e.ripple(),create:l,depend:()=>e.rv,get:t=>t.rv,isReactive:i,onSet:w}}function k(e){p=e,v(e).set({lock:!0,pristine:!0,handlers:{"@init":h,"@jsv":t=>t.js,batch:d,def:t=>t.js.def,eager:t=>t.js.eager,error:t=>t.js.error,fv:t=>n.fv(t.js),rio:t=>l(t.js),rv:t=>t.js.rv,set:g,unready:t=>t.js.unready(),untr:y,wait:t=>n.wait()}})}export{k as install};
