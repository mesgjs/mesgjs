import{getInterface as h,runIfCode as f,setRO as c}from"./runtime.esm.js";import{reactive as r}from"./vendor.esm.js";c(globalThis,"reactive",r);let p;function j(e){switch(e?.msjsType){case"@code":return()=>e("run");case"@function":return e("jsfn");case p:return e("@jsv").getter;default:return e}}function l(e){switch(e?.msjsType){case"@code":return e("fn")("jsfn");case"@function":return e("jsfn");default:return e}}function y(e){const{mp:t}=e,s=t.at(0);if(s?.$reactive===r.type)c(e.octx,"js",s);else{const n=t.at("cmp"),a=t.at("def");typeof n=="function"&&t.set("cmp",l(n)),typeof a=="function"&&t.set("def",j(a)),!t.has("v")&&t.has(0)&&t.set("v",t.at(0)),c(e.octx,"js",r(t?.storage||{}))}c(e.js,$c.symbols.instance,e.rr,!1),c(e.rr,{jsv:e.js,valueOf:()=>e.js})}function v(e){const t=e.mp.at(0);if(typeof t=="function")return t.msjsType?r.batch(()=>f(t)):r.batch(t)}function b(e){const{js:t,mp:s}=e;for(const n of s.entries())switch(n[0]){case"def":typeof n[1]=="function"&&(t.def=j(n[1]));break;case"eager":case"eager1":case"eager2":t.eager=n[1];break;case"v":case"0":t.wv=n[1];break}return e.rr}function g(e){const t=e.mp.at(0);if(typeof t=="function")return t.msjsType?r.unbatch(()=>f(e.mp.at(0))):r.unbatch(t)}function d(e){const t=e.mp.at(0);if(typeof t=="function")return t.msjsType?r.untracked(()=>f(e.mp.at(0))):r.untracked(t)}const i=e=>!!r.typeOf(e),w=(e,t,s)=>{const n=e.atRaw(t),a=i(n),u=i(s);if(a)return u?n.def=s:n.wv=s,n;if(e.options.autoReactive){const o=r();return u?o.def=s:o.wv=s,o}return s};function m(e){return e||(e=r()),{batch:r.batch,changed:()=>e.ripple(),create:m,depend:()=>e.rv,get:t=>t.rv,isReactive:i,onSet:w}}function R(e){p=e,h(e).set({lock:!0,pristine:!0,handlers:{"@init":y,"@jsv":t=>t.js,batch:v,def:t=>t.js.def,eager:t=>t.js.eager,error:t=>t.js.error,fv:t=>r.fv(t.js),rio:t=>m(t.js),rv:t=>t.js.rv,set:b,unbatch:g,unready:t=>t.js.unready(),untr:d,wait:t=>r.wait()}})}export{R as install};
