import{getInterface as i,MsjsFlow as u,runIfCode as l,setRO as h,throwFlow as f}from"./runtime.esm.js";function p(a){const{mp:t,js:e}=a;delete e.exception,delete e.result,e.active=!0;try{for(const s of t.values()){e.capture=!1;try{e.result=l(s)}catch(r){if(!e.capture)throw r;if(e.hasFlowRes&&(e.result=e.flowRes,e.hasFlowRes=e.flowRes=!1),r.message==="stop")break}}}catch(s){if(s instanceof u)throw s;if(e.exception=s,t.has("catchers"))for(const o of t.at("catchers").entries()){const c=globalThis[o[0]];if(!(typeof c!="function"||!(s instanceof c))){if(o[1]?.msjsType!=="@code")return o[1];e.capture=!1;try{o[1]("run")}catch(n){if(!e.capture)throw n;e.hasFlowRes&&(e.result=e.flowRes,e.hasFlowRes=e.flowRes=!1)}return e.result}}if(!t.has("catch"))throw s;const r=t.at("catch");if(r?.msjsType!=="@code")return r;e.capture=!1;try{r("run")}catch(o){if(!e.capture)throw o;e.hasFlowRes&&(e.result=e.flowRes,e.hasFlowRes=e.flowRes=!1)}}finally{l(t.at("always")),e.active=!1}return e.result}function x(a){i(a).set({lock:!0,pristine:!0,handlers:{"@init":t=>h(t.octx,"js",{}),error:t=>t.js.exception,message:t=>t.js.exception?.message,name:t=>t.js.exception?.name,next:t=>f(t,"next",a),result:t=>t.js.result,return:t=>{t.js.result=t.mp.at(0)},stop:t=>f(t,"stop",a),try:p}})}export{x as install};
