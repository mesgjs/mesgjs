import{getInterface as h,msjsInstance as j,setRO as o,throwFlow as i}from"./runtime.esm.js";import{NANOS as n}from"./vendor.esm.js";const l=t=>t&&new n(t,{groups:t.groups&&new n(t.groups)});function w(t){const e=t.mp.at(0,""),s=e instanceof RegExp?e:new RegExp(e,t.mp.at(1,""));o(t.rr,"jsv",s),o(t.octx,"js",{re:s}),o(t.js,j,t.rr,!1)}function x(t){const{js:e,mp:s}=t,m=s.at("each"),f=s.at("else"),p=s.at("collect");delete e.capture,delete e.match,e.num=-1;let c=p?new n:void 0;const r=a=>{p?c.push(a):c=a};e.active=!0;try{for(const a of s.at(0,"").matchAll(e.re))if(++e.num,m?.msjsType==="@code"){e.match=l(a);try{r(m("run"))}catch(u){if(!e.capture)throw u;if(e.hasFlowRes&&(r(e.flowRes),e.hasFlowRes=e.flowRes=!1),u.message==="stop")break;delete e.capture}}if(e.num<0&&f?.msjsType==="@code")try{r(f("run"))}catch(a){if(!e.capture)throw a;e.hasFlowRes&&(r(e.flowRes),e.hasFlowRes=e.flowRes=!1)}}finally{e.active=!1}return c}function y(){const t="@regex";h(t).set({lock:!0,pristine:!0,handlers:{"@init":w,"@jsv":e=>e.js.re,exec:e=>l(e.js.re.exec(e.mp.at(0,""))),flags:e=>e.js.re.flags,last:e=>e.js.re.lastIndex,match:e=>e.js.match,match1:e=>l(e.mp.at(0,"").match(e.js.re)),matchAll:x,next:e=>i(e,"next",t),num:e=>e.js.num,search:e=>e.mp.at(0,"").search(e.js.re),setLast:e=>(e.js.re.lastIndex=e.mp.at(0,0),e.rr),source:e=>e.js.re.source,stop:e=>i(e,"stop",t),test:e=>e.js.re.test(e.mp.at(0,""))}})}export{y as install};
