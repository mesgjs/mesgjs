import{debugConfig as x,fcheck as u,fready as m,fwait as d,getInstance as i,getInterface as f,getModMeta as A,logInterfaces as E,modHasCap as v,runIfCode as s,runWhileCode as g,setModMeta as M,setRO as h,typeAccepts as l,typeChains as w}from"./runtime.esm.js";import{NANOS as y,parseQJSON as O,parseSLID as T}from"./vendor.esm.js";function C(o){const{mp:e}=o;let t=!0;for(const n of e.values())if(t=s(n),!t)return t;return t}function k(o){const{mp:e}=o,t=e.at("collect");let n=t?new y:void 0;const c=r=>{t?n.push(r):n=r},a=async()=>{for(const r of e.values())c(await s(r))},p=i("@promise");return a().then(()=>p.resolve(n)),p}function q(o){const{mp:e}=o,t=e.at(0),n=t?.msjsType,c=e.next-1,a=l(n,"caseEq")?"caseEq":l(n,"eq")?"eq":void 0,p=a?r=>t(a,r):r=>t===r;for(let r=1;r<c;r+=2)if(p(s(e.at(r))))return s(e.at(r+1));return s(e.at("else"))}function I(o){const{mp:e}=o;return i(e.at(0),e.at("init"))}function b(o){const{mp:e}=o,t=e.next-1;for(let n=0;n<t;n+=2)if(s(e.at(n)))return s(e.at(n+1));if(e.has("else"))return s(e.at("else"));if(e.next%2)return s(e.at(t))}function j(o){const{mp:e}=o;let t=!1;for(const n of e.values())if(t=s(n),t)return t;return t}function H(o){const{mp:e}=o,t=e.at("collect");let n=t?new y:void 0;const c=a=>{t?n.push(a):n=a};if(e.at("repeat"))for(const a of e.values())c(g(a));else for(const a of e.values())c(s(a));return n}function N(o){const{mp:e}=o,t=e.at(0);throw t instanceof Error?t:new Error(t)}function R(o){const{mp:e}=o;let t=!1;for(const n of e.values()){const c=s(n);if(c){if(t)return!1;t=c}}return t}function D(o){f(o).set({final:!0,lock:!0,pristine:!0,singleton:!0,handlers:{_:e=>e.mp.at(0),"&":C,":":q,"+":I,"?":b,"~":e=>!s(e.mp.at(0)),"|":j,and:C,await:k,case:q,debug:e=>x(e.mp),fcheck:e=>u(e.mp.at(0)),fwait:e=>d(...e.mp.values()),fready:e=>m(e.mp.at("mid"),e.mp.at(0)),get:I,if:b,interface:e=>f(e.mp.at(0)),log:e=>console.log(...e.mp.values()),logErr:e=>console.error(...e.mp.values()),logInterfaces:E,logWarn:e=>console.warn(...e.mp.values()),modHasCap:e=>v(e.mp.at(0),e.mp.at(1)),not:e=>!s(e.mp.at(0)),or:j,qjson:e=>O(e.mp.at(0,"")),run:H,slid:e=>T(e.mp.at(0,"")),throw:N,type:e=>globalThis.$toMsjs(e.mp.at(0))?.msjsType,typeAccepts:e=>l(e.mp.at(0),e.mp.at(1)),typeChains:e=>w(e.mp.at(0),e.mp.at(1)),xor:R},cacheHints:{":":"pin","+":"pin","?":"pin",case:"pin",get:"pin",if:"pin"}}),o==="@core"&&(h(globalThis,"$c",i("@core")),Object.assign($c,{fcheck:u,fready:m,fwait:d,getInstance:i,getInterface:f,getModMeta:A,modHasCap:v,runIfCode:s,runWhileCode:g,setModMeta:M,setRO:h,typeAccepts:l,typeChains:w}))}export{D as install};
