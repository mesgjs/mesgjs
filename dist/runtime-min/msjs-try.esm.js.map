{
  "version": 3,
  "sources": ["../../src/runtime/msjs-try.esm.js"],
  "sourcesContent": ["/*\n * Mesgjs @try interface\n * Author: Brian Katzung <briank@kappacs.com>\n * Copyright 2025 by Kappa Computer Solutions, LLC and Brian Katzung\n */\n\nimport { getInterface, MsjsFlow, runIfCode, setRO, throwFlow } from './runtime.esm.js';\n\n// @try(try code... catchers=[type=code...]? catch=code? always=code?)\n// @try(atry ...)\n// Async version - the main code blocks (not error handlers) may be async; returns a (JS) promise\nfunction opTry (d) {\n\tconst { mp, js } = d;\n\tconst onCatch = (ex) => {\n\t\tif (!js.capture) throw ex;\n\t\tif (js.hasFlowRes) {\n\t\t\tjs.result = js.flowRes;\n\t\t\tjs.hasFlowRes = js.flowRes = false;\n\t\t}\n\t\treturn (ex.message === 'stop');\n\t};\n\tconst result = (rv = js.result) => ((d.dop === 'atry') ? Promise.resolve(rv) : rv);\n\tdelete js.exception;\n\tdelete js.result;\n\tjs.active = true;\n\ttry {\n\t\tif (d.dop === 'atry') return (async () => {\n\t\t\tfor (const v of mp.values()) {\n\t\t\t\tjs.capture = false;\n\t\t\t\ttry { js.result = await runIfCode(v); }\n\t\t\t\tcatch (ex) { if (onCatch(ex)) break; }\n\t\t\t}\n\t\t\treturn js.result;\n\t\t})();\n\t\tfor (const v of mp.values()) {\n\t\t\tjs.capture = false;\n\t\t\ttry { js.result = runIfCode(v); }\n\t\t\tcatch (ex) { if (onCatch(ex)) break; }\n\t\t}\n\t\treturn js.result;\n\t}\n\tcatch (ex) {\n\t\tif (ex instanceof MsjsFlow) throw ex;\n\t\tjs.exception = ex;\n\t\tif (mp.has('catchers')) for (const en of mp.at('catchers').entries()) {\n\t\t\tconst clob = globalThis[en[0]];\n\t\t\tif (typeof clob !== 'function' || !(ex instanceof clob)) continue;\n\t\t\tif (en[1]?.msjsType !== '@code') return result(en[1]);\n\t\t\tjs.capture = false;\n\t\t\ttry { en[1]('run'); }\n\t\t\tcatch (ex) {\n\t\t\t\tif (!js.capture) throw ex;\n\t\t\t\tif (js.hasFlowRes) {\n\t\t\t\t\tjs.result = js.flowRes;\n\t\t\t\t\tjs.hasFlowRes = js.flowRes = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result();\n\t\t}\n\t\tif (!mp.has('catch')) throw ex;\n\t\tconst cv = mp.at('catch');\n\t\tif (cv?.msjsType !== '@code') return result(cv);\n\t\tjs.capture = false;\n\t\ttry { cv('run'); }\n\t\tcatch (ex) {\n\t\t\tif (!js.capture) throw ex;\n\t\t\tif (js.hasFlowRes) {\n\t\t\t\tjs.result = js.flowRes;\n\t\t\t\tjs.hasFlowRes = js.flowRes = false;\n\t\t\t}\n\t\t}\n\t}\n\tfinally {\n\t\trunIfCode(mp.at('always'));\n\t\tjs.active = false;\n\t}\n\treturn result();\n}\n\nexport function install (name) {\n\tgetInterface(name).set({\n\t\tlock: true, pristine: true,\n\t\thandlers: {\n\t\t\t'@init': d => setRO(d.octx, 'js', {}),\n\t\t\tatry: opTry,\n\t\t\terror: d => d.js.exception,\n\t\t\tmessage: d => d.js.exception?.message,\n\t\t\tname: d => d.js.exception?.name,\n\t\t\tnext: d => throwFlow(d, 'next', name),\n\t\t\tresult: d => d.js.result,\n\t\t\treturn: d => { d.js.result = d.mp.at(0); },\n\t\t\tstop: d => throwFlow(d, 'stop', name),\n\t\t\ttry: opTry,\n\t\t},\n\t});\n}\n\n// END\n"],
  "mappings": "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",
  "names": ["getInterface", "MsjsFlow", "runIfCode", "setRO", "throwFlow", "opTry", "d", "mp", "js", "onCatch", "ex", "result", "rv", "v", "en", "clob", "cv", "install", "name"]
}
