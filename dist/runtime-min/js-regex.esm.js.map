{
  "version": 3,
  "sources": ["../../src/runtime/js-regex.esm.js"],
  "sourcesContent": ["/*\n * Mesgjs @regex interface - JS RegExp wrapper\n * Author: Brian Katzung <briank@kappacs.com>\n * Copyright 2025 by Kappa Computer Solutions, LLC and Brian Katzung\n */\n\nimport { getInterface, setRO, throwFlow } from './runtime.esm.js';\n\nconst listize = (res) => res && new NANOS(res, { groups: res.groups && new NANOS(res.groups) });\n\nfunction opInit (d) {\n\tconst raw = d.mp.at(0, ''), re = (raw instanceof RegExp) ? raw : new RegExp(raw, d.mp.at(1, ''));\n\tsetRO(d.rr, { jsv: re, valueOf: () => re });\n\tsetRO(d.octx, 'js', { re });\n\tsetRO(d.js.re, $c.symbols.instance, d.rr, false);\n}\n\n// regex(matchAll string each={block!} else={block!} collect=@f)\nfunction opMatchAll (d) {\n\tconst { js, mp } = d;\n\tconst each = mp.at('each'), ls = mp.at('else'), collect = mp.at('collect');\n\tdelete js.capture;\n\tdelete js.match;\n\tjs.num = -1;\t\t\t\t\t\t// -1 = no matches (so far)\n\tlet result = collect ? new NANOS() : undefined;\n\tconst save = res => { if (collect) result.push(res); else result = res; };\n\tjs.active = true;\n\ttry {\n\t\tfor (const match of mp.at(0, '').matchAll(js.re)) {\n\t\t\t++js.num;\t\t\t\t\t// 0-based match number\n\t\t\tif (each?.msjsType === '@code') {\n\t\t\t\tjs.match = listize(match);\n\t\t\t\ttry { save(each('run')); }\n\t\t\t\tcatch (ex) {\n\t\t\t\t\tif (!js.capture) throw ex;\n\t\t\t\t\tif (js.hasFlowRes) {\n\t\t\t\t\t\tsave(js.flowRes);\n\t\t\t\t\t\tjs.hasFlowRes = js.flowRes = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (ex.message === 'stop') break;\n\t\t\t\t\tdelete js.capture;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (js.num < 0 && ls?.msjsType === '@code') {\n\t\t\ttry { save(ls('run')); }\n\t\t\tcatch (ex) {\n\t\t\t\tif (!js.capture) throw ex;\n\t\t\t\tif (js.hasFlowRes) {\n\t\t\t\t\tsave(js.flowRes);\n\t\t\t\t\tjs.hasFlowRes = js.flowRes = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} finally { js.active = false; }\n\treturn result;\n}\n\nexport function install () {\n\tconst name = '@regex';\n\tgetInterface(name).set({\n\t\tlock: true, pristine: true,\n\t\thandlers: {\n\t\t\t'@init': opInit,\n\t\t\t'@jsv': d => d.js.re,\n\t\t\texec: d => listize(d.js.re.exec(d.mp.at(0, ''))),\n\t\t\tflags: d => d.js.re.flags,\n\t\t\tlast: d => d.js.re.lastIndex,\n\t\t\tmatch: d => d.js.match,\n\t\t\tmatch1: d => listize(d.mp.at(0, '').match(d.js.re)),\n\t\t\tmatchAll: opMatchAll,\n\t\t\tnext: d => throwFlow(d, 'next', name),\n\t\t\tnum: d => d.js.num,\t\t\t// current match number\n\t\t\tsearch: d => d.mp.at(0, '').search(d.js.re),\n\t\t\tsetLast: d => { d.js.re.lastIndex = d.mp.at(0, 0); return d.rr; },\n\t\t\tsource: d => d.js.re.source,\n\t\t\tstop: d => throwFlow(d, 'stop', name),\n\t\t\ttest: d => d.js.re.test(d.mp.at(0, '')),\n\t\t},\n\t});\n}\n\n// END\n\n"],
  "mappings": "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",
  "names": ["getInterface", "setRO", "throwFlow", "listize", "res", "opInit", "d", "raw", "re", "opMatchAll", "js", "mp", "each", "ls", "collect", "result", "save", "match", "ex", "install", "name"]
}
