{
  "version": 3,
  "sources": ["../../src/runtime/msjs-core.esm.js"],
  "sourcesContent": ["/*\n * Mesgjs @core Interface\n * Author: Brian Katzung <briank@kappacs.com>\n * Copyright 2025 by Kappa Computer Solutions, LLC and Brian Katzung\n */\n\nimport { debugConfig, fcheck, fready, fwait, getInstance, getInterface, getModMeta, logInterfaces, modHasCap, runIfCode, runWhileCode, setModMeta, setRO, typeAccepts, typeChains } from './runtime.esm.js';\nimport { NANOS, parseQJSON, parseSLID } from './vendor.esm.js';\n\n// (and value...)\n// And: false result if any not true, else last true result (default true)\nfunction opAnd (d) {\n    const { mp } = d;\n    let result = true;\n    for (const v of mp.values()) {\n\tresult = runIfCode(v);\n\tif (!result) return result;\n    }\n    return result;\n}\n\n// (await {block!}... collect=@f)\nfunction opAwait (d) {\n    const { mp } = d, collect = mp.at('collect');\n    let result = collect ? new NANOS() : undefined;\n    const save = v => { if (collect) result.push(v); else result = v; };\n    const runBlocks = async () => {\n\tfor (const v of mp.values()) save(await runIfCode(v));\n    };\n    const whenDone = getInstance('@promise');\n    runBlocks.then(() => whenDone.resolve(result));\n    return whenDone;\n}\n\n// (case val cmp1 res1 ... cmpN resN else=default)\nfunction opCase (d) {\n    const { mp } = d, val = mp.at(0), type = val?.msjsType, stop = mp.next - 1;\n    const op = typeAccepts(type, 'caseEq') ? 'caseEq' : typeAccepts(type, 'eq') ? 'eq' : undefined, eq = op ? (to => val(op, to)) : (to => val === to);\n    for (let i = 1; i < stop; i += 2) if (eq(runIfCode(mp.at(i)))) return runIfCode(mp.at(i + 1));\n    return runIfCode(mp.at('else'));\n}\n\n// (get type init=params)\nfunction opGet (d) {\n    const { mp } = d;\n    return getInstance(mp.at(0), mp.at('init'));\n}\n\n// (if cond1 then1 cond2 then2 ... else=value)\nfunction opIf (d) {\n    const { mp } = d, end = mp.next - 1;\n    for (let i = 0; i < end; i += 2) if (runIfCode(mp.at(i))) return runIfCode(mp.at(i + 1));\n    /*\n     * Return the else value if provided; otherwise return the final\n     * expression if there's an odd number of expressions.\n     */\n    if (mp.has('else')) return runIfCode(mp.at('else'));\n    if (mp.next % 2) return runIfCode(mp.at(end));\n}\n\n// function opImport (d) {\n// }\n\n// (or value...)\n// Or: first true result, else last false result (default false)\nfunction opOr (d) {\n    const { mp } = d;\n    let result = false;\n    for (const v of mp.values()) {\n\tresult = runIfCode(v);\n\tif (result) return result;\n    }\n    return result;\n}\n\n// (run {block!}... repeat=@f collect=@f)\nfunction opRun (d) {\n    const { mp } = d, collect = mp.at('collect');\n    let result = collect ? new NANOS() : undefined;\n    const save = v => { if (collect) result.push(v); else result = v; };\n    if (mp.at('repeat')) for (const v of mp.values()) save(runWhileCode(v));\n    else for (const v of mp.values()) save(runIfCode(v));\n    return result;\n}\n\n// (throw error)\nfunction opThrow (d) {\n    const { mp } = d, err = mp.at(0);\n    throw ((err instanceof Error) ? err : new Error(err));\n}\n\n// Returns true if exactly one value is true\nfunction opXor (d) {\n    const { mp } = d;\n    let result = false;\n    for (const v of mp.values()) {\n\tconst curRes = runIfCode(v);\n\tif (curRes) {\n\t    if (result) return false;\n\t    result = curRes;\n\t}\n    }\n    return result;\n}\n\nexport function install (name) {\n    getInterface(name).set({\n\tfinal: true, lock: true, pristine: true, singleton: true,\n\thandlers: {\n\t    _: d => d.mp.at(0),\t\t// underscore (\"basically parentheses\")\n\t    '&': opAnd,\n\t    ':': opCase,\n\t    '+': opGet,\n\t    '?': opIf,\n\t    '~': d => !runIfCode(d.mp.at(0)),\t// not\n\t    '|': opOr,\n\t    and: opAnd,\n\t    await: opAwait,\n\t    case: opCase,\n\t    debug: d => debugConfig(d.mp),\n\t    fcheck: d => fcheck(d.mp.at(0)),\n\t    fwait: d => fwait(...d.mp.values()),\n\t    fready: d => fready(d.mp.at('mid'), d.mp.at(0)),\n\t    get: opGet,\t\t\t// Get instance\n\t    if: opIf,\n\t    interface: d => getInterface(d.mp.at(0)),\n\t    log: d => console.log(...d.mp.values()),\n\t    logErr: d => console.error(...d.mp.values()),\n\t    logInterfaces,\n\t    logWarn: d => console.warn(...d.mp.values()),\n\t    modHasCap: d => modHasCap(d.mp.at(0), d.mp.at(1)),\n\t    not: d => !runIfCode(d.mp.at(0)),\n\t    or: opOr,\n\t    qjson: d => parseQJSON(d.mp.at(0, '')),\n\t    run: opRun,\n\t    slid: d => parseSLID(d.mp.at(0, '')),\n\t    throw: opThrow,\n\t    type: d => globalThis.$toMsjs(d.mp.at(0))?.msjsType,\n\t    typeAccepts: d => typeAccepts(d.mp.at(0), d.mp.at(1)),\n\t    typeChains: d => typeChains(d.mp.at(0), d.mp.at(1)),\n\t    xor: opXor,\n\t},\n\tcacheHints: {\n\t    ':': 'pin',\n\t    '+': 'pin',\n\t    '?': 'pin',\n\t    case: 'pin',\n\t    get: 'pin',\n\t    if: 'pin',\n\t},\n    });\n    if (name === '@core') {\n\tsetRO(globalThis, '$c', getInstance('@core'));\n\t// \"Re-export\" common runtime functions on $c to reduce imports\n\tObject.assign($c, {\n\t    fcheck,\n\t    fready,\n\t    fwait,\n\t    getInstance,\n\t    getInterface,\n\t    getModMeta,\n\t    modHasCap,\n\t    runIfCode,\n\t    runWhileCode,\n\t    setModMeta,\n\t    setRO,\n\t    typeAccepts,\n\t    typeChains,\n\t});\n\t// BEST PRACTICE: Make $c immutable after loading in mesgjs.esm.js\n    }\n}\n\n// END\n"],
  "mappings": "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",
  "names": ["debugConfig", "fcheck", "fready", "fwait", "getInstance", "getInterface", "getModMeta", "logInterfaces", "modHasCap", "runIfCode", "runWhileCode", "setModMeta", "setRO", "typeAccepts", "typeChains", "NANOS", "parseQJSON", "parseSLID", "opAnd", "d", "mp", "result", "v", "opAwait", "collect", "save", "runBlocks", "whenDone", "opCase", "val", "type", "stop", "op", "eq", "to", "i", "opGet", "opIf", "end", "opOr", "opRun", "opThrow", "err", "opXor", "curRes", "install", "name"]
}
