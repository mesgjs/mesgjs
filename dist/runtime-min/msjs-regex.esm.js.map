{
  "version": 3,
  "sources": ["../../src/runtime/msjs-regex.esm.js"],
  "sourcesContent": ["/*\n * Mesgjs @regex interface\n * Author: Brian Katzung <briank@kappacs.com>\n * Copyright 2025 by Kappa Computer Solutions, LLC and Brian Katzung\n */\n\nimport { getInterface, setRO, throwFlow } from './runtime.esm.js';\n\nconst listize = (res) => res && new NANOS(res, { groups: res.groups && new NANOS(res.groups) });\n\nfunction opInit (d) {\n    const raw = d.mp.at(0, ''), re = (raw instanceof RegExp) ? raw : new RegExp(raw, d.mp.at(1, ''));\n    setRO(d.rr, { jsv: re, valueOf: () => re });\n    setRO(d.octx, 'js', { re });\n    setRO(d.js.re, $c.symbols.instance, d.rr, false);\n}\n\n// regex(matchAll string each={block!} else={block!} collect=@f)\nfunction opMatchAll (d) {\n    const { js, mp } = d;\n    const each = mp.at('each'), ls = mp.at('else'), collect = mp.at('collect');\n    delete js.capture;\n    delete js.match;\n    js.num = -1;\t\t\t// -1 = no matches (so far)\n    let result = collect ? new NANOS() : undefined;\n    const save = res => { if (collect) result.push(res); else result = res; };\n    js.active = true;\n    try {\n\tfor (const match of mp.at(0, '').matchAll(js.re)) {\n\t    ++js.num;\t\t\t// 0-based match number\n\t    if (each?.msjsType === '@code') {\n\t\tjs.match = listize(match);\n\t\ttry { save(each('run')); }\n\t\tcatch (ex) {\n\t\t    if (!js.capture) throw ex;\n\t\t    if (js.hasFlowRes) {\n\t\t\tsave(js.flowRes);\n\t\t\tjs.hasFlowRes = js.flowRes = false;\n\t\t    }\n\t\t    if (ex.message === 'stop') break;\n\t\t    delete js.capture;\n\t\t}\n\t    }\n\t}\n\tif (js.num < 0 && ls?.msjsType === '@code') {\n\t    try { save(ls('run')); }\n\t    catch (ex) {\n\t\tif (!js.capture) throw ex;\n\t\tif (js.hasFlowRes) {\n\t\t    save(js.flowRes);\n\t\t    js.hasFlowRes = js.flowRes = false;\n\t\t}\n\t    }\n\t}\n    } finally { js.active = false; }\n    return result;\n}\n\nexport function install () {\n    const name = '@regex';\n    getInterface(name).set({\n\tlock: true, pristine: true,\n\thandlers: {\n\t    '@init': opInit,\n\t    '@jsv': d => d.js.re,\n\t    exec: d => listize(d.js.re.exec(d.mp.at(0, ''))),\n\t    flags: d => d.js.re.flags,\n\t    last: d => d.js.re.lastIndex,\n\t    match: d => d.js.match,\n\t    match1: d => listize(d.mp.at(0, '').match(d.js.re)),\n\t    matchAll: opMatchAll,\n\t    next: d => throwFlow(d, 'next', name),\n\t    num: d => d.js.num,\t\t// current match number\n\t    search: d => d.mp.at(0, '').search(d.js.re),\n\t    setLast: d => { d.js.re.lastIndex = d.mp.at(0, 0); return d.rr; },\n\t    source: d => d.js.re.source,\n\t    stop: d => throwFlow(d, 'stop', name),\n\t    test: d => d.js.re.test(d.mp.at(0, '')),\n\t},\n    });\n}\n\n// END\n\n"],
  "mappings": "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",
  "names": ["getInterface", "setRO", "throwFlow", "listize", "res", "opInit", "d", "raw", "re", "opMatchAll", "js", "mp", "each", "ls", "collect", "result", "save", "match", "ex", "install", "name"]
}
