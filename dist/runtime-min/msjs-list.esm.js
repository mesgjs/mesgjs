import{getInstance as f,getInterface as O,runIfCode as l,setRO as j}from"./runtime.esm.js";import{unifiedList as h,uniAt as y}from"./unified-list.esm.js";function k(s){const{octx:t,mp:e}=s,n=e.at(0);j(t,"js",n instanceof NANOS?n:new NANOS),j(s.rr,{jsv:s.js,valueOf:()=>s.js})}function u(s){const{mp:t}=s,e=t.has("path")?h(t.at("path")).values():t.values();return y(s.js,[...e],{wrap:!0,raw:t.at("raw"),defaultFn:()=>{if(t.has("else"))return l(t.at("else"));throw new Error("Key path not found")}})}function S(){if(this.list.has(this.key))return this.list.at(this.key);if(this.hasElse)return l(this.elseVal);throw new Error(`Required key ${this.key} not present`)}function w(s){const{js:t,mp:e}=s,n=e.at(0),i=e.has("else"),r=e.at("else");return s.b({cd:S.bind({list:t,key:n,hasElse:i,elseVal:r})})}function v(s){return s.mp.has(0)?(s.js.next=s.mp.at(0),s.rr):s.js.next}function m(s){const{mp:t,js:e}=s;for(const n of t.namedEntries())e.set(n[0],n[1])}function A(s){const{js:t,mp:e}=s;if(e.has(0)){let n=e.at(0);return n===!0&&(n=f("@reactive")("rio")),t.rio=n,s.rr}return!!t.rio}function x(s){const{js:t}=s;t.rio||(t.rio=f("@reactive")("rio"));const e=t.rio;t.setOpts({autoReactive:!0});for(const n of t.keys()){const i=t.at(n,{raw:!0}),r=e.isReactive(i),o=r?i.rv:i;r||t.set(n,i),o instanceof NANOS&&$toMsjs(o)("rxt")}}function E(s){const t=s.mp,e=t.at("insert"),n=t.at("raw");this.list.set(this.key,s.mp.at(0),{insert:e,raw:n})}function R(s){const{js:t,mp:e}=s,n=e.at(0);return s.b({cd:E.bind({list:t,key:n})})("fn")}const g=s=>{const t=typeof s;return t==="string"||t==="number"||t==="symbol"};function N(s){const{mp:t}=s,e=t.has("path")?h(t.at("path")).values():t.values(),n=t.at("insert"),i=t.at("raw"),r=[...e].filter(p=>g(p)),o=r.length-(t.has("to")?1:0);let a=s.js;for(let p=0;p<o;++p){const c=r[p];a.at(c)instanceof NANOS||a.set(c,a.similar()),a=a.at(c)}t.has("to")?a.set(r[o],t.at("to"),{insert:n,raw:i}):(t.has("first")&&a.unshift(t.at("first")),t.has("next")&&a.push(t.at("next")))}function K(s){return s.js.setOpts(Object.fromEntries(s.mp.namedEntries())),s.rr}function b(s){O(s).set({lock:!0,pristine:!0,handlers:{"@init":k,"@jsv":t=>t.js,"@":u,"==":m,">":t=>t.js.pop(),"|+":t=>t.js.push(t.mp),"=":N,"<":t=>t.js.shift(),"+|":t=>t.js.unshift(t.mp),at:u,clear:t=>t.js.clear(),copy:t=>new NANOS().fromPairs(t.js.pairs()),delete:t=>t.js.delete(t.mp.at(0)),depend:t=>t.js.depend(),entries:t=>new NANOS([...t.js.entries()]),get:u,getter:w,has:t=>t.js.has(t.mp.at(0)),includes:t=>t.js.includes(t.mp.at(0)),indexEntries:t=>new NANOS([...t.js.indexEntries(t.mp.at(0))]),indexKeys:t=>new NANOS([...t.js.indexKeys()]),isLocked:t=>t.js.isLocked(t.mp.at(0)),isRedacted:t=>t.js.isRedacted(t.mp.at(0)),keyOf:t=>t.js.keyOf(t.mp.at(0)),keyIter:t=>t.js.keys(),keys:t=>new NANOS([...t.js.keys()]),lastKeyOf:t=>t.js.lastKeyOf(t.mp.at(0)),lock:t=>t.js.lock(...t.mp.indexValues()),lockAll:t=>t.js.lockAll(t.mp.at(0)),lockKeys:t=>t.js.lockKeys(),namedEntries:t=>new NANOS([...t.js.namedEntries()]),namedKeys:t=>new NANOS([...t.js.namedKeys()]),next:v,nset:m,options:t=>new NANOS(t.js.options),pairs:t=>new NANOS(t.js.pairs(t.mp.at(0))),pop:t=>t.js.pop(),push:t=>t.js.push(t.mp),push1:t=>t.js.push(t.mp.at(0)),redact:t=>t.js.redact(...t.mp.indexValues()),reverse:t=>t.js.reverse(),rio:A,rxt:x,self:t=>t.js,set:N,setOpts:K,setter:R,shift:t=>t.js.shift(),size:t=>t.js.size,toJSON:t=>t.js.toJSON(),toReversed:t=>t.js.toReversed(),toSLID:t=>t.js.toSLID(t.mp?.storage||{}),toString:t=>t.js.toString(t.mp?.storage||{}),unshift:t=>t.js.unshift(t.mp),values:t=>new NANOS([...t.js.values()])},cacheHints:{"@init":"pin",at:"pin",has:"pin",nset:"pin",set:"pin"}})}export{b as install};
